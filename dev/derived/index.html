<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Derived Variables · DirectDetections.jl</title><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.039/juliamono-regular.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.11/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><script src="../../copy.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">DirectDetections.jl</a></span></div><form class="docs-search" action="../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><a class="tocitem" href="../getting-started/">Getting Started</a></li><li><span class="tocitem">Tutorials</span><ul><li><a class="tocitem" href="../modelling/">Fit Astrometry</a></li><li><a class="tocitem" href="../pma/">Fit Astrometric Acceleration</a></li><li><a class="tocitem" href="../images/">Fit Images</a></li><li class="is-active"><a class="tocitem" href>Derived Variables</a><ul class="internal"><li><a class="tocitem" href="#System-Variables"><span>System Variables</span></a></li><li><a class="tocitem" href="#Planet-Variables"><span>Planet Variables</span></a></li><li><a class="tocitem" href="#Linking-Planets"><span>Linking Planets</span></a></li><li><a class="tocitem" href="#Resolution-Order"><span>Resolution Order</span></a></li></ul></li><li><a class="tocitem" href="../mass-photometry/">Connecting Mass with Photometry</a></li><li><a class="tocitem" href="../loading-saving/">Loading and Saving Data</a></li></ul></li><li><span class="tocitem">Documentation</span><ul><li><a class="tocitem" href="../priors/">Priors</a></li><li><a class="tocitem" href="../samplers/">Samplers</a></li><li><a class="tocitem" href="../chains/">Chains</a></li><li><a class="tocitem" href="../kepler/">Kepler Solver</a></li><li><a class="tocitem" href="../api/">API</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Tutorials</a></li><li class="is-active"><a href>Derived Variables</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Derived Variables</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/sefffal/DirectDetections.jl/blob/master/docs/src/derived.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="derived"><a class="docs-heading-anchor" href="#derived">Derived Variables</a><a id="derived-1"></a><a class="docs-heading-anchor-permalink" href="#derived" title="Permalink"></a></h1><p>DirectDetections has a concept called &quot;derived variables&quot; that are inspired by PyMC3. Derived variables are quantities that either have a fixed value, or a fixed mathematical relationship with the main variables in a model.</p><p>This concept is extremely powerful, as it lets you quickly create very sophisticated models.</p><p>Derived variables allow you to mark certain properties as constants, reparameterize models, link properties between planets in multi-planet systems, plug in physical models, and more.</p><h2 id="System-Variables"><a class="docs-heading-anchor" href="#System-Variables">System Variables</a><a id="System-Variables-1"></a><a class="docs-heading-anchor-permalink" href="#System-Variables" title="Permalink"></a></h2><p>Derived variables for the system as a whole can be created as follows:</p><pre><code class="language-julia hljs">@named HD12345 = System(
    Derived(
        μ = sys -&gt; 1.0
    ),
    Priors(
        plx =Normal(45., 0.02),
    )
)</code></pre><p>In this case, instead of including <code>μ</code> as a variable in the model, we define it as a function that always returns <code>1.0</code>.</p><p>In the following case, let&#39;s define <code>μ</code> as being calculated based on another variable in the model. This is how you can do reparameterizations in DirectDetections.jl</p><pre><code class="language-julia hljs">@named HD12345 = System(
    Derived(
        μ = sys -&gt; 10^sys.logμ
    ),
    Priors(
        plx =Normal(45., 0.02),
        logμ =Normal(45., 0.02),
    )
)</code></pre><p>We defined a new variable <code>logμ</code> under priors, and then used the <code>Derived</code> block to calculate <code>μ</code> from the other variables in the model.</p><p>In general, you can write any function you want to map from any of combination of constants and variables in the model to new variables. The only constraints are that your functions always return the same outputs for the same inputs, and are differentiable. These functions will be called in a tight loop, so you should try to make sure they are as efficient as possible.</p><h2 id="Planet-Variables"><a class="docs-heading-anchor" href="#Planet-Variables">Planet Variables</a><a id="Planet-Variables-1"></a><a class="docs-heading-anchor-permalink" href="#Planet-Variables" title="Permalink"></a></h2><p>Derived variables for an individual planet are similar, but have access to both the planet&#39;s variables and the system as a whole.</p><p>Here is an example of reparameterizing <code>e</code> and <code>a</code> on a planet to be logarithmic quantities:</p><pre><code class="language-julia hljs">@named b = Planet(
    Derived(
        e = (sys, pl) -&gt; 10^pl.loge,
        a = (sys, pl) -&gt; 10^pl.loga,
    ),
    Priors(
        τ = Normal(0.5, 1),
        ω = Normal(0.1, deg2rad(30.)),
        i = Normal(0.1, deg2rad(30.)),
        Ω = Normal(0.0, deg2rad(30.)),
        loge = Uniform(-4, 1),
        loga = Normal(1, 1)
    ),
)</code></pre><p>Here <code>e</code> is defined as log-uniform, and <code>a</code> as log-normal.</p><h2 id="Linking-Planets"><a class="docs-heading-anchor" href="#Linking-Planets">Linking Planets</a><a id="Linking-Planets-1"></a><a class="docs-heading-anchor-permalink" href="#Linking-Planets" title="Permalink"></a></h2><p>Planets can have Derived variables that are calculated from variables defined on the system as a whole. This makes it easy to, for example, create a system of two planets that are co-planar.</p><pre><code class="language-julia hljs">@named b = Planet(
    Derived(
        i = (sys, pl) -&gt; sys.i,
        Ω = (sys, pl) -&gt; sys.Ω,
    ),
    Priors(
        a = Uniform(0, 15),
        e = TruncatedNormal(0, 0.1, 0, 1),
        ω = Normal(0.1, deg2rad(30.)),
        τ = Normal(0.5, 1),
    ),
)
@named c = Planet(
    Derived(
        i = (sys, pl) -&gt; sys.i,
        Ω = (sys, pl) -&gt; sys.Ω,
    ),
    Priors(
        a = Uniform(15, 45),
        e = TruncatedNormal(0, 0.1, 0, 1),
        ω = Normal(0.1, deg2rad(30.)),
        τ = Normal(0.5, 1),
    ),
)
@named HD12345 = System(
    Priors(
        plx = Normal(45., 0.02),
        μ = Normal(45., 0.02),
        i = Normal(0.1, deg2rad(30.)),
        Ω = Normal(0.0, deg2rad(30.)),
    ),
    b, c
)</code></pre><p>Notice how <code>i</code> and <code>Ω</code> are defined as variables on the System. The two planets B &amp; C omit those two variables from their priors, and instead just take their values from the System.</p><h2 id="Resolution-Order"><a class="docs-heading-anchor" href="#Resolution-Order">Resolution Order</a><a id="Resolution-Order-1"></a><a class="docs-heading-anchor-permalink" href="#Resolution-Order" title="Permalink"></a></h2><p>The order that variables are resolved is as follows:</p><ul><li>Variables defined as priors for the system and planets</li><li>Derived variables on the system</li><li>Derived variables on each planet</li></ul><p>It&#39;s not possible to observe one derived variable from another derived variable in a System or one Derived variable from another on a Planet but it is possible to see the System&#39;s Derived variables in the Planets&#39;.</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../images/">« Fit Images</a><a class="docs-footer-nextpage" href="../mass-photometry/">Connecting Mass with Photometry »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.12 on <span class="colophon-date" title="Thursday 24 February 2022 04:57">Thursday 24 February 2022</span>. Using Julia version 1.7.2.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
