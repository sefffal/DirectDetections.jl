<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Fit Astrometric Acceleration · DirectDetections.jl</title><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.039/juliamono-regular.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.11/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">DirectDetections.jl</a></span></div><form class="docs-search" action="../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><a class="tocitem" href="../getting-started/">Getting Started</a></li><li><span class="tocitem">Tutorials</span><ul><li><a class="tocitem" href="../modelling/">Fit Astrometry</a></li><li><a class="tocitem" href="../images/">Fit Images</a></li><li class="is-active"><a class="tocitem" href>Fit Astrometric Acceleration</a><ul class="internal"><li><a class="tocitem" href="#Planet-Model-and-Reparameterization"><span>Planet Model &amp; Reparameterization</span></a></li><li><a class="tocitem" href="#System-Model-and-Specifying-Proper-Motion-Anomaly"><span>System Model &amp; Specifying Proper Motion Anomaly</span></a></li><li><a class="tocitem" href="#Sampling-from-the-posterior"><span>Sampling from the posterior</span></a></li><li><a class="tocitem" href="#Analysis"><span>Analysis</span></a></li></ul></li><li><a class="tocitem" href="../mass-photometry/">Connecting Mass with Photometry</a></li></ul></li><li><span class="tocitem">Documentation</span><ul><li><a class="tocitem" href="../samplers/">Samplers</a></li><li><a class="tocitem" href="../chains/">Chains</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Tutorials</a></li><li class="is-active"><a href>Fit Astrometric Acceleration</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Fit Astrometric Acceleration</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/sefffal/DirectDetections.jl/blob/master/docs/src/pma.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="fit-pma"><a class="docs-heading-anchor" href="#fit-pma">Fit Astrometric Acceleration</a><a id="fit-pma-1"></a><a class="docs-heading-anchor-permalink" href="#fit-pma" title="Permalink"></a></h1><p>One of the features of DirectDetections.jl is support for proper motion anomaly / astrometric acceleration. These data points are typically calculated by finding the difference between a long term proper motion of a star between the Hipparcos and GAIA catalogs, and their proper motion calculated within the windows of each catalog.</p><p>For Hipparcos/GAIA this gives four data points that can constrain the dynamical mass &amp; orbits of planetary companions (assuming we subtract out the net trend).</p><p>You can specify these quantities manually, but the easiest way is to use the Hipparcos-GAIA Catalog of Accelerations (HGCA, <a href="https://arxiv.org/abs/2105.11662">https://arxiv.org/abs/2105.11662</a>). Support for loading this catalog is built into DirectDetections.jl.</p><p>Let&#39;s look at the star and companion <a href="https://arxiv.org/abs/2109.12124">HD 91312 A &amp; B</a>, discovered by SCExAO. We will use their published astrometry and proper motion anomaly extracted from the HGCA.</p><p>The first step is to find the GAIA source ID for your object. For HD 91312, SIMBAD tells us the GAIA DR2 ID is <code>756291174721509376</code> (which we will assume is the same in eDR3).</p><h2 id="Planet-Model-and-Reparameterization"><a class="docs-heading-anchor" href="#Planet-Model-and-Reparameterization">Planet Model &amp; Reparameterization</a><a id="Planet-Model-and-Reparameterization-1"></a><a class="docs-heading-anchor-permalink" href="#Planet-Model-and-Reparameterization" title="Permalink"></a></h2><p>For this model, we will have to add the variable <code>mass</code> as a prior. A reasonable uninformative prior for <code>mass</code> is <code>Uniform(0,1)</code>.</p><pre><code class="language-julia hljs">@named B = DirectDetections.Planet(
    Priors(
        a = Uniform(0, 35),
        e = TruncatedNormal(0.0, 0.2, 0, 1.0),
        τ = Uniform(0, 1),
        ω = Uniform(0, 2pi),
        i = Uniform(0, 2pi),
        Ω = Uniform(0, 2pi),
        mass = Uniform(0,1)
    ),
    Astrometry(
        (epoch=mjd(&quot;2016-12-15&quot;), ra=0.133*1e3, dec=-0.174*1e3, σ_ra=0.007*1e3, σ_dec=0.007*1e3),
        (epoch=mjd(&quot;2017-03-12&quot;), ra=0.126*1e3, dec=-0.176*1e3, σ_ra=0.004*1e3, σ_dec=0.004*1e3),
        (epoch=mjd(&quot;2017-03-13&quot;), ra=0.127*1e3, dec=-0.172*1e3, σ_ra=0.004*1e3, σ_dec=0.004*1e3),
        (epoch=mjd(&quot;2018-02-08&quot;), ra=0.083*1e3, dec=-0.133*1e3, σ_ra=0.010*1e3, σ_dec=0.010*1e3),
        (epoch=mjd(&quot;2018-11-28&quot;), ra=0.058*1e3, dec=-0.122*1e3, σ_ra=0.010*1e3, σ_dec=0.020*1e3),
        (epoch=mjd(&quot;2018-12-15&quot;), ra=0.056*1e3, dec=-0.104*1e3, σ_ra=0.008*1e3, σ_dec=0.008*1e3),
    )
)</code></pre><p>If you try this you may find that the sampler hits a lot of numerical errors. This is because it will often try to push <code>mass</code> to zero or below, which falls outside the bounds of our prior. This is okay if it happens occaisionally, but on some models this can really lower our efficienty.</p><p>Let&#39;s use <code>Deterministic</code> to reparameterize both <code>mass</code> and <code>a</code> using logarithmic variables:</p><pre><code class="language-julia hljs">
@named B = DirectDetections.Planet(
    Deterministic(
        e = (sys, pl) -&gt; 10^pl.loge,
        a = (sys, pl) -&gt; 10^pl.loga,
        mass = (sys, pl) -&gt; 10^pl.logm,
    ),
    Priors(
        # Note: priors with sharp edges (e.g. Uniform priors) are challenging for HMC samplers.
        # Using wide Gaussians can be better than uniform priors, for example.
        τ = Normal(0.5, 1),
        ω = Normal(pi, 2pi),
        i = Normal(pi, 2pi),
        Ω = Normal(pi, 2pi),

        # Reparameterize a few properties for better sampling
        loge = TruncatedNormal(-2, 1.5, -Inf, 0),
        loga = Uniform(-1, 1.5),
        logm = Uniform(-2, 0),
    ),
    Astrometry(
        (epoch=mjd(&quot;2016-12-15&quot;), ra=0.133*1e3, dec=-0.174*1e3, σ_ra=0.007*1e3, σ_dec=0.007*1e3),
        (epoch=mjd(&quot;2017-03-12&quot;), ra=0.126*1e3, dec=-0.176*1e3, σ_ra=0.004*1e3, σ_dec=0.004*1e3),
        (epoch=mjd(&quot;2017-03-13&quot;), ra=0.127*1e3, dec=-0.172*1e3, σ_ra=0.004*1e3, σ_dec=0.004*1e3),
        (epoch=mjd(&quot;2018-02-08&quot;), ra=0.083*1e3, dec=-0.133*1e3, σ_ra=0.010*1e3, σ_dec=0.010*1e3),
        (epoch=mjd(&quot;2018-11-28&quot;), ra=0.058*1e3, dec=-0.122*1e3, σ_ra=0.010*1e3, σ_dec=0.020*1e3),
        (epoch=mjd(&quot;2018-12-15&quot;), ra=0.056*1e3, dec=-0.104*1e3, σ_ra=0.008*1e3, σ_dec=0.008*1e3),
    )
)</code></pre><p>We specified <code>loga</code> and <code>logm</code> under priors, but our model still needs the variables <code>a</code> and <code>mass</code>. For these, we specify functions in the Deterministic block. Each deterministic variable for a planet should be a function accepting the system parameters, and planet parameters. In this case, we will access the <code>loga</code> and <code>logm</code> parameters and use them to calculate <code>a</code> and <code>mass</code>.</p><h2 id="System-Model-and-Specifying-Proper-Motion-Anomaly"><a class="docs-heading-anchor" href="#System-Model-and-Specifying-Proper-Motion-Anomaly">System Model &amp; Specifying Proper Motion Anomaly</a><a id="System-Model-and-Specifying-Proper-Motion-Anomaly-1"></a><a class="docs-heading-anchor-permalink" href="#System-Model-and-Specifying-Proper-Motion-Anomaly" title="Permalink"></a></h2><p>Now that we have our planet model, we create a system model to contain it.</p><pre><code class="language-julia hljs">@named HD91312 = System(
    Priors(
        μ = Normal(1.61, 0.05),
        plx = gaia_plx(gaia_id=756291174721509376),
    ),  
    ProperMotionAnomHGCA(gaia_id=756291174721509376),
    B,
)</code></pre><p>We specify priors on <code>μ</code> and <code>plx</code> as usual, but here we use the <code>gaia_plx</code> helper function to read the parallax and uncertainty directly from the HGCA using its source ID.</p><p>After the priors, we add the proper motion anomaly measurements from the HGCA. If this is your first time running this code, you will be prompted to automatically download and cache the catalog which may take around 30 seconds.</p><h2 id="Sampling-from-the-posterior"><a class="docs-heading-anchor" href="#Sampling-from-the-posterior">Sampling from the posterior</a><a id="Sampling-from-the-posterior-1"></a><a class="docs-heading-anchor-permalink" href="#Sampling-from-the-posterior" title="Permalink"></a></h2><p>Ssample from our model as usual:</p><pre><code class="language-julia hljs">chain, stats = DirectDetections.hmc(
    HD91312,
    adaptation =  10_000,
    iterations = 100_000,
    tree_depth =     12,
);</code></pre><p>This took 35s on an older laptop, single core.</p><h2 id="Analysis"><a class="docs-heading-anchor" href="#Analysis">Analysis</a><a id="Analysis-1"></a><a class="docs-heading-anchor-permalink" href="#Analysis" title="Permalink"></a></h2><h3 id="Mass"><a class="docs-heading-anchor" href="#Mass">Mass</a><a id="Mass-1"></a><a class="docs-heading-anchor-permalink" href="#Mass" title="Permalink"></a></h3><p>Let&#39;s start by plotting a histogram of the companion mass.</p><p><code>chain[&quot;B[mass]&quot;]</code> may be a matrix if multiple indepdendent chains were run, so we call <code>vec</code> to reshape it into a column vector.</p><pre><code class="language-julia hljs">mass_B = chain[&quot;B[mass]&quot;]
histogram(vec(mass_B), xlabel=&quot;mass (M⊙)&quot;, ylabel=&quot;&quot;, legend=false)</code></pre><p><a href="../assets/pma-astrometry-mass-hist.svg"><img src="../assets/pma-astrometry-mass-hist.svg" alt="mass histogram"/></a></p><h3 id="Orbits"><a class="docs-heading-anchor" href="#Orbits">Orbits</a><a id="Orbits-1"></a><a class="docs-heading-anchor-permalink" href="#Orbits" title="Permalink"></a></h3><p>Now plot a sample of orbits from the posterior to see how well they  fit the astrometry and proper motion anomaly.</p><pre><code class="language-julia hljs">plotmodel(chain, HD91312, clims=(7.2, 7.4))</code></pre><p><a href="../assets/pma-astrometry-mass-model.svg"><img src="../assets/pma-astrometry-mass-model.png" alt="orbits"/></a></p><h3 id="Pair-Plot"><a class="docs-heading-anchor" href="#Pair-Plot">Pair Plot</a><a id="Pair-Plot-1"></a><a class="docs-heading-anchor-permalink" href="#Pair-Plot" title="Permalink"></a></h3><p>Visualize all the parameters as a pair-plot:</p><pre><code class="language-julia hljs">##Create a corner plot / pair plot.
# We can access any property from the chain specified in Priors or in Deterministic.
using PairPlots
table = (;
    a=         chain[&quot;B[a]&quot;],
    μ=         chain[&quot;μ&quot;],
    m=         chain[&quot;B[mass]&quot;],
    e=         chain[&quot;B[e]&quot;],
    i=rad2deg.(chain[&quot;B[i]&quot;]),
    Ω=rad2deg.(chain[&quot;B[Ω]&quot;]),
    ω=rad2deg.(chain[&quot;B[ω]&quot;]),
    τ=         chain[&quot;B[τ]&quot;],
)
labels=[
    &quot;a&quot;,
    &quot;\\mu&quot;,
    &quot;m&quot;,
    &quot;e&quot;,
    &quot;i&quot;,
    &quot;\\Omega&quot;,
    &quot;\\omega&quot;,
    &quot;\\tau&quot;,
]
units = [
    &quot;(au)&quot;,
    &quot;(_\\odot)&quot;,
    &quot;(_\\odot)&quot;,
    &quot;&quot;,
    &quot;(\\degree)&quot;,
    &quot;(\\degree)&quot;,
    &quot;(\\degree)&quot;,
    &quot;&quot;,
]
corner(table, labels, units)</code></pre><p><a href="../assets/pma-astrometry-mass-corner.svg"><img src="../assets/pma-astrometry-mass-corner.png" alt="pair plot"/></a></p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../images/">« Fit Images</a><a class="docs-footer-nextpage" href="../mass-photometry/">Connecting Mass with Photometry »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.7 on <span class="colophon-date" title="Wednesday 6 October 2021 20:06">Wednesday 6 October 2021</span>. Using Julia version 1.6.3.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
