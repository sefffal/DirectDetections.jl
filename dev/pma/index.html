<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Fit Astrometric Acceleration · DirectDetections.jl</title><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.039/juliamono-regular.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.11/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">DirectDetections.jl</a></span></div><form class="docs-search" action="../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><a class="tocitem" href="../getting-started/">Getting Started</a></li><li><span class="tocitem">Tutorials</span><ul><li><a class="tocitem" href="../modelling/">Fit Astrometry</a></li><li><a class="tocitem" href="../images/">Fit Images</a></li><li class="is-active"><a class="tocitem" href>Fit Astrometric Acceleration</a><ul class="internal"><li><a class="tocitem" href="#Planet-Model"><span>Planet Model</span></a></li><li><a class="tocitem" href="#System-Model-and-Specifying-Proper-Motion-Anomaly"><span>System Model &amp; Specifying Proper Motion Anomaly</span></a></li><li><a class="tocitem" href="#Sampling-from-the-posterior"><span>Sampling from the posterior</span></a></li><li><a class="tocitem" href="#Analysis"><span>Analysis</span></a></li></ul></li><li><a class="tocitem" href="../derived/">Derived Variables</a></li><li><a class="tocitem" href="../mass-photometry/">Connecting Mass with Photometry</a></li></ul></li><li><span class="tocitem">Documentation</span><ul><li><a class="tocitem" href="../samplers/">Samplers</a></li><li><a class="tocitem" href="../chains/">Chains</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Tutorials</a></li><li class="is-active"><a href>Fit Astrometric Acceleration</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Fit Astrometric Acceleration</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/sefffal/DirectDetections.jl/blob/master/docs/src/pma.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="fit-pma"><a class="docs-heading-anchor" href="#fit-pma">Fit Astrometric Acceleration</a><a id="fit-pma-1"></a><a class="docs-heading-anchor-permalink" href="#fit-pma" title="Permalink"></a></h1><p>One of the features of DirectDetections.jl is support for proper motion anomaly / astrometric acceleration. These data points are typically calculated by finding the difference between a long term proper motion of a star between the Hipparcos and GAIA catalogs, and their proper motion calculated within the windows of each catalog.</p><p>For Hipparcos/GAIA this gives four data points that can constrain the dynamical mass &amp; orbits of planetary companions (assuming we subtract out the net trend).</p><p>You can specify these quantities manually, but the easiest way is to use the Hipparcos-GAIA Catalog of Accelerations (HGCA, <a href="https://arxiv.org/abs/2105.11662">https://arxiv.org/abs/2105.11662</a>). Support for loading this catalog is built into DirectDetections.jl.</p><p>Let&#39;s look at the star and companion <a href="https://arxiv.org/abs/2109.12124">HD 91312 A &amp; B</a>, discovered by SCExAO. We will use their published astrometry and proper motion anomaly extracted from the HGCA.</p><p>The first step is to find the GAIA source ID for your object. For HD 91312, SIMBAD tells us the GAIA DR2 ID is <code>756291174721509376</code> (which we will assume is the same in eDR3).</p><h2 id="Planet-Model"><a class="docs-heading-anchor" href="#Planet-Model">Planet Model</a><a id="Planet-Model-1"></a><a class="docs-heading-anchor-permalink" href="#Planet-Model" title="Permalink"></a></h2><p>For this model, we will have to add the variable <code>mass</code> as a prior. The units used on this variable are Jupiter masses, in contrast to <code>μ</code>, the primary&#39;s mass, in solar masses.  A reasonable uninformative prior for <code>mass</code> is <code>Uniform(0,1000)</code> or <code>LogUniform(1,1000)</code> depending on the situation.</p><p>Initial setup:</p><pre><code class="language-julia hljs">using DirectDetections, Distributions, Plots</code></pre><pre><code class="language-julia hljs">@named B = DirectDetections.Planet(
    Priors(
        a = Uniform(1, 25),
        e = Beta(2,15),
        # Note: priors with sharp edges (e.g. Uniform priors) are challenging for HMC samplers.
        # An alternative could be wide Gaussians, for example.
        τ = Normal(0.5, 1),
        ω = Normal(pi, 2pi),
        i = Normal(pi, 2pi),
        Ω = Normal(pi, 2pi),
        # mass = LogUniform(0.5, 2000),
        mass = Uniform(0.5, 2000),
    ),
    Astrometry(
        (epoch=mjd(&quot;2016-12-15&quot;), ra=133., dec=-174., σ_ra=07.0, σ_dec=07.),
        (epoch=mjd(&quot;2017-03-12&quot;), ra=126., dec=-176., σ_ra=04.0, σ_dec=04.),
        (epoch=mjd(&quot;2017-03-13&quot;), ra=127., dec=-172., σ_ra=04.0, σ_dec=04.),
        (epoch=mjd(&quot;2018-02-08&quot;), ra=083., dec=-133., σ_ra=10.0, σ_dec=10.),
        (epoch=mjd(&quot;2018-11-28&quot;), ra=058., dec=-122., σ_ra=10.0, σ_dec=20.),
        (epoch=mjd(&quot;2018-12-15&quot;), ra=056., dec=-104., σ_ra=08.0, σ_dec=08.),
    )
);</code></pre><h2 id="System-Model-and-Specifying-Proper-Motion-Anomaly"><a class="docs-heading-anchor" href="#System-Model-and-Specifying-Proper-Motion-Anomaly">System Model &amp; Specifying Proper Motion Anomaly</a><a id="System-Model-and-Specifying-Proper-Motion-Anomaly-1"></a><a class="docs-heading-anchor-permalink" href="#System-Model-and-Specifying-Proper-Motion-Anomaly" title="Permalink"></a></h2><p>Now that we have our planet model, we create a system model to contain it.</p><pre><code class="language-julia hljs">@named HD91312 = System(
    Priors(
        μ = Normal(1.61, 0.05),
        plx = gaia_plx(gaia_id=756291174721509376),
    ),  
    ProperMotionAnomHGCA(gaia_id=756291174721509376),
    B,
)</code></pre><p>We specify priors on <code>μ</code> and <code>plx</code> as usual, but here we use the <code>gaia_plx</code> helper function to read the parallax and uncertainty directly from the HGCA using its source ID.</p><p>After the priors, we add the proper motion anomaly measurements from the HGCA. If this is your first time running this code, you will be prompted to automatically download and cache the catalog which may take around 30 seconds.</p><h2 id="Sampling-from-the-posterior"><a class="docs-heading-anchor" href="#Sampling-from-the-posterior">Sampling from the posterior</a><a id="Sampling-from-the-posterior-1"></a><a class="docs-heading-anchor-permalink" href="#Sampling-from-the-posterior" title="Permalink"></a></h2><p>Ssample from our model as usual:</p><pre><code class="language-julia hljs">chain, stats = DirectDetections.hmc(
    HD91312, 0.65,
    adaptation =  1_000,
    iterations = 10_000,
);
display(chain)</code></pre><p>Output:</p><pre><code class="nohighlight hljs">Sampling report:
mean_accept = 0.8538973684799083
num_err_frac = 0.0102
mean_tree_depth = 3.2545
max_tree_depth_frac = 0.0
Chains MCMC chain (10000×9×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 11.43 seconds
Compute duration  = 11.43 seconds
parameters        = μ, plx, B[a], B[e], B[τ], B[ω], B[i], B[Ω], B[mass]

Summary Statistics
  parameters       mean       std   naive_se      mcse         ess      rhat   ess_per_sec ⋯
      Symbol    Float64   Float64    Float64   Float64     Float64   Float64       Float64 ⋯

           μ     1.6123    0.0496     0.0005    0.0006   6567.9890    1.0001      574.5769 ⋯
         plx    29.1438    0.1411     0.0014    0.0015   8176.9434    0.9999      715.3305 ⋯
        B[a]     6.7216    0.0928     0.0009    0.0017   3061.4284    1.0002      267.8181 ⋯
        B[e]     0.2056    0.0440     0.0004    0.0008   3378.2624    1.0003      295.5352 ⋯
        B[τ]    -0.8507    0.0265     0.0003    0.0005   3789.5866    0.9999      331.5184 ⋯
        B[ω]    -6.6247    0.1028     0.0010    0.0019   3071.5674    1.0009      268.7050 ⋯
        B[i]     1.4768    0.0292     0.0003    0.0005   3296.3292    1.0001      288.3675 ⋯
        B[Ω]    11.9009    0.0147     0.0001    0.0002   5376.1724    1.0000      470.3151 ⋯
     B[mass]   271.7459   92.4623     0.9246    2.4161   1195.0382    1.0022      104.5436 ⋯

Quantiles
  parameters       2.5%      25.0%      50.0%      75.0%      97.5% 
      Symbol    Float64    Float64    Float64    Float64    Float64

           μ     1.5160     1.5786     1.6120     1.6462     1.7085
         plx    28.8621    29.0483    29.1438    29.2381    29.4209
        B[a]     6.5367     6.6589     6.7218     6.7851     6.9002
        B[e]     0.1241     0.1753     0.2034     0.2352     0.2973
        B[τ]    -0.8941    -0.8695    -0.8538    -0.8351    -0.7918
        B[ω]    -6.8125    -6.6942    -6.6294    -6.5626    -6.4023
        B[i]     1.4156     1.4579     1.4775     1.4967     1.5310
        B[Ω]    11.8709    11.8911    11.9012    11.9110    11.9284
     B[mass]   165.5598   209.0807   246.8737   306.0517   536.6443</code></pre><p>This is quite quick even on an older laptop, single core.</p><h2 id="Analysis"><a class="docs-heading-anchor" href="#Analysis">Analysis</a><a id="Analysis-1"></a><a class="docs-heading-anchor-permalink" href="#Analysis" title="Permalink"></a></h2><p>We can use the <code>plotmodel</code> helper to summarize the results.</p><pre><code class="language-julia hljs">plotmodel(chain, HD91312, color=:mass, pma_scatter=:mass)</code></pre><p><a href="../assets/pma-astrometry-posterior.svg"><img src="../assets/pma-astrometry-posterior.png" alt="mass histogram"/></a></p><h3 id="Pair-Plot"><a class="docs-heading-anchor" href="#Pair-Plot">Pair Plot</a><a id="Pair-Plot-1"></a><a class="docs-heading-anchor-permalink" href="#Pair-Plot" title="Permalink"></a></h3><p>Visualize all the parameters as a pair-plot:</p><pre><code class="language-julia hljs">##Create a corner plot / pair plot.
# We can access any property from the chain specified in Priors or in Deterministic.
using PairPlots
table = (;
    a=         chain[&quot;B[a]&quot;],
    μ=         chain[&quot;μ&quot;],
    m=         chain[&quot;B[mass]&quot;],
    e=         chain[&quot;B[e]&quot;],
    i=rad2deg.(chain[&quot;B[i]&quot;]),
    Ω=rad2deg.(chain[&quot;B[Ω]&quot;]),
    ω=rad2deg.(chain[&quot;B[ω]&quot;]),
    τ=         chain[&quot;B[τ]&quot;],
)
labels=[
    &quot;a&quot;,
    &quot;\\mu&quot;,
    &quot;m&quot;,
    &quot;e&quot;,
    &quot;i&quot;,
    &quot;\\Omega&quot;,
    &quot;\\omega&quot;,
    &quot;\\tau&quot;,
]
units = [
    &quot;(au)&quot;,
    &quot;(_\\odot)&quot;,
    &quot;(_\\odot)&quot;,
    &quot;&quot;,
    &quot;(\\degree)&quot;,
    &quot;(\\degree)&quot;,
    &quot;(\\degree)&quot;,
    &quot;&quot;,
]
corner(table, labels, units)</code></pre><p><a href="../assets/pma-astrometry-mass-corner.svg"><img src="../assets/pma-astrometry-mass-corner.png" alt="pair plot"/></a></p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../images/">« Fit Images</a><a class="docs-footer-nextpage" href="../derived/">Derived Variables »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.10 on <span class="colophon-date" title="Tuesday 30 November 2021 02:01">Tuesday 30 November 2021</span>. Using Julia version 1.6.4.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
