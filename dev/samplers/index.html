<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Samplers · DirectDetections.jl</title><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.039/juliamono-regular.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.11/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">DirectDetections.jl</a></span></div><form class="docs-search" action="../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><a class="tocitem" href="../getting-started/">Getting Started</a></li><li><span class="tocitem">Tutorials</span><ul><li><a class="tocitem" href="../modelling/">Fit Astrometry</a></li><li><a class="tocitem" href="../images/">Fit Images</a></li><li><a class="tocitem" href="../pma/">Fit Astrometric Acceleration</a></li><li><a class="tocitem" href="../mass-photometry/">Connecting Mass with Photometry</a></li></ul></li><li><span class="tocitem">Documentation</span><ul><li class="is-active"><a class="tocitem" href>Samplers</a><ul class="internal"><li><a class="tocitem" href="#Hamiltonian-Monte-Carlo"><span>Hamiltonian Monte Carlo</span></a></li><li><a class="tocitem" href="#Affine-Invariant-MCMC"><span>Affine Invariant MCMC</span></a></li><li><a class="tocitem" href="#Nested-Sampling"><span>Nested Sampling</span></a></li></ul></li><li><a class="tocitem" href="../chains/">Chains</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Documentation</a></li><li class="is-active"><a href>Samplers</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Samplers</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/sefffal/DirectDetections.jl/blob/master/docs/src/samplers.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="samplers"><a class="docs-heading-anchor" href="#samplers">Samplers</a><a id="samplers-1"></a><a class="docs-heading-anchor-permalink" href="#samplers" title="Permalink"></a></h1><p>DirectDetections.jl includes support for three Monte Carlo samplers: Affine Invariant MCMC (KissMCMC.jl), the No U-Turn Sampler (NUTS) which is Hamiltonian Monte Carlo (AdvancedHMC.jl), and finally, nested sampling (NestedSamplers.jl).</p><h2 id="Hamiltonian-Monte-Carlo"><a class="docs-heading-anchor" href="#Hamiltonian-Monte-Carlo">Hamiltonian Monte Carlo</a><a id="Hamiltonian-Monte-Carlo-1"></a><a class="docs-heading-anchor-permalink" href="#Hamiltonian-Monte-Carlo" title="Permalink"></a></h2><p>The recommended choice for almost all problems is Hamiltonian Monte Carlo. It can be run using the <code>DirectDetections.hmc</code> function. This sampling  method makes use of derivative information, and is much more efficient. This package by default uses the No U-Turn sampler, as implemented in AdvancedHMC.jl.</p><p>Derviatives for a complex model are usualy tedious to code, but DirectDetections uses ForwardDiff.jl to generate them automatically.</p><p>When using HMC, only a few chains are necessary. This is in contrast to Affine Invariant MCMC based packages where hundreds or thousands of walkers are required. One chain should be enough to cover the whole posterior, but you can run a few different chains to make sure each has converged to the same distribution.</p><p>Similarily, fewer samples are required. This is because unlike Affine Invariant MCMC, HMC produces samples that are much less correlated after each step (i.e. the autocorrelation time is much shorter).</p><h3 id="Usage"><a class="docs-heading-anchor" href="#Usage">Usage</a><a id="Usage-1"></a><a class="docs-heading-anchor-permalink" href="#Usage" title="Permalink"></a></h3><p>The method signature of <code>DirectDetections.hmc</code> is as follows:</p><pre><code class="language-julia hljs">function hmc(
    system::System, target_accept=0.85;
    adaptation,
    iterations,
    tree_depth=10,
    include_adapatation=false,
    initial_samples=100_000,
    initial_parameters=nothing,
)</code></pre><p>The two positional arguments  are <code>system</code>, the model you wish to sample; and <code>target_accept</code>, the acceptance rate that should be targeted during windowed adaptation. During this time, the step size and mass matrix will be adapted (see AdvancedHMC.jl for more information). The number of steps taken during adaptation is controlled by <code>adaptation</code>. You can prevent these samples from being dropped by pasing <code>include_adaptation=false</code>. The total number of posterior samples produced are given by <code>iterations</code>. These include the adaptation steps that may be discarded. <code>tree_depth</code> controls the maximum tree depth of the sampler. <code>initial_parameters</code> is an optional way to pass a starting point for the chain. If you don&#39;t pass a default position, one will be selected by drawing <code>initial_samples</code> from the priors. The sample with the highest posterior value will be used as the starting point.</p><h2 id="Affine-Invariant-MCMC"><a class="docs-heading-anchor" href="#Affine-Invariant-MCMC">Affine Invariant MCMC</a><a id="Affine-Invariant-MCMC-1"></a><a class="docs-heading-anchor-permalink" href="#Affine-Invariant-MCMC" title="Permalink"></a></h2><p>Affine Invariant MCMC is the sampling method used in the ever-popular <code>emcee</code> Python package. It is included here to aid in reproducing results from papers using that method.</p><p>This method is very robust, and does not require gradient information to sample the posterior. However, DirectDetections calculates gradients automatically using ForwardDiff.jl.</p><p>One limitation of Affine Invariant MCMC is that it performs very poorly on posteriors with high curvature. Unfortuantely, fitting orbits of planets using Keplerian elements often produces just such a posterior. In these situations, the sampling will reduce to a random walk around the mode. This is hard to diagnose, and results in inflated uncertainty estimates.</p><p>This can be partially mitigated using tempering, as in the <code>ptemcee</code> Python package. </p><p>One application where Affine Invariant MCMC is useful, is if you require completely flat/uniform priors and/or priors that have a sharp discontinuity. These are very challenging for HMC.</p><p>The method signature of <code>DirectDetections.mcmc</code> is:</p><pre><code class="language-julia hljs">mcmc(
    system::System;
    burnin,
    numwalkers,
    numsamples_perwalker,
    thinning = 1,
    squash = true,
)</code></pre><h2 id="Nested-Sampling"><a class="docs-heading-anchor" href="#Nested-Sampling">Nested Sampling</a><a id="Nested-Sampling-1"></a><a class="docs-heading-anchor-permalink" href="#Nested-Sampling" title="Permalink"></a></h2><p>Support for nested sampling is still work in progress.</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../mass-photometry/">« Connecting Mass with Photometry</a><a class="docs-footer-nextpage" href="../chains/">Chains »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.7 on <span class="colophon-date" title="Sunday 3 October 2021 22:11">Sunday 3 October 2021</span>. Using Julia version 1.6.3.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
